<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick CSS Live Editor Loader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        code {
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Quick CSS Live Editor Loader</h1>
    <div id="status">
        <div class="status loading">Initializing resource loader...</div>
    </div>

    <script>
    (function() {
        // Configuration - Update these to match your repository
        const CONFIG = {
            githubUser: 'fumeko-ts',
            repoName: 'Quick-CSS-Live-Editor',
            branch: 'main',
            jsPath: 'main.js',
            cssPath: 'src/ui.css'
        };

        // Generate URLs
        const BASE_URL = `https://${CONFIG.githubUser}.github.io/${CONFIG.repoName}`;
        const CDN_URL = `https://cdn.jsdelivr.net/gh/${CONFIG.githubUser}/${CONFIG.repoName}@${CONFIG.branch}`;
        
        const RESOURCES = {
            js: {
                urls: [
                    `${CDN_URL}/${CONFIG.jsPath}`,  // CDN first
                    `${BASE_URL}/${CONFIG.jsPath}`  // GitHub Pages fallback
                ],
                element: null
            },
            css: {
                urls: [
                    `${CDN_URL}/${CONFIG.cssPath}`,  // CDN first
                    `${BASE_URL}/${CONFIG.cssPath}`  // GitHub Pages fallback
                ],
                element: null
            }
        };

        // DOM elements
        const statusEl = document.getElementById('status');
        
        function updateStatus(message, type) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            statusEl.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function loadResource(type) {
            return new Promise((resolve) => {
                const resource = RESOURCES[type];
                let attempts = 0;

                function tryLoad() {
                    if (attempts >= resource.urls.length) {
                        updateStatus(`Failed to load ${type.toUpperCase()} after ${attempts} attempts`, 'error');
                        return resolve(false);
                    }

                    const url = resource.urls[attempts];
                    updateStatus(`Loading ${type.toUpperCase()} from: ${url}`, 'loading');

                    const element = type === 'css' 
                        ? document.createElement('link')
                        : document.createElement('script');

                    if (type === 'css') {
                        element.rel = 'stylesheet';
                        element.href = url;
                    } else {
                        element.src = url;
                    }

                    element.onload = () => {
                        updateStatus(`Successfully loaded ${type.toUpperCase()} from ${url}`, 'success');
                        resource.element = element;
                        resolve(true);
                    };

                    element.onerror = () => {
                        attempts++;
                        updateStatus(`Failed to load ${type.toUpperCase()} from ${url}, trying next source...`, 'error');
                        tryLoad();
                    };

                    document.head.appendChild(element);
                }

                tryLoad();
            });
        }

        async function initialize() {
            updateStatus('Starting resource loading process...', 'loading');
            
            try {
                // Load CSS first for better rendering
                const cssLoaded = await loadResource('css');
                const jsLoaded = await loadResource('js');

                if (cssLoaded && jsLoaded) {
                    updateStatus('All resources loaded successfully! Quick CSS Live Editor is ready.', 'success');
                    
                    // Dispatch custom event when fully loaded
                    document.dispatchEvent(new CustomEvent('quickcssloaded', {
                        detail: {
                            version: '1.0',
                            loadedAt: new Date().toISOString()
                        }
                    }));
                } else {
                    updateStatus('Some resources failed to load. Editor may not work properly.', 'error');
                }
            } catch (error) {
                updateStatus(`Critical error during loading: ${error.message}`, 'error');
            }
        }

        // Start loading when DOM is ready
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            initialize();
        } else {
            document.addEventListener('DOMContentLoaded', initialize);
        }
    })();
    </script>
</body>
</html>
